(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0aef7700"],{"01dd":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"c-exam-take"},[s("div",{staticClass:"c-exam-take-main"},[s("div",{staticClass:"m-exam-take-header",class:{isDone:t.isSubmitted}},[s("div",{staticClass:"c-exam-take-title"},[s("h1",[t._v(" 《"+t._s(t.examInfo?t.examInfo.title:"试卷")+"》 ")])]),t.examInfo?s("div",{staticClass:"c-exam-take-attr"},[s("h3",[t._v(t._s(t.examInfo.desc))]),s("p",{staticClass:"c-exam-attr-content"},[s("span",{staticClass:"c-exam-attr-prop"},[t._v("出卷人：")]),s("span",{staticClass:"c-exam-attr-value"},[s("el-link",{attrs:{href:t.paperAuthorLink,target:"_blank",underline:!1}},[t._v(" "+t._s(t.examInfo.author)+" ")])],1)]),t.examInfo.tags?s("p",{staticClass:"c-exam-attr-content"},[s("span",{staticClass:"c-exam-attr-prop"},[t._v("试卷标签：")]),s("span",{staticClass:"c-exam-attr-value"},t._l(JSON.parse(t.examInfo.tags),(function(e){return s("el-tag",{key:e,attrs:{size:"medium"}},[t._v(t._s(e))])})),1)]):t._e(),t._m(0),t.views>=0?s("span",{staticClass:"u-views"},[s("i",{staticClass:"el-icon-view"},[t._v(" "+t._s(t.views))])]):t._e(),s("QRcode"),s("span",{staticStyle:{"margin-left":"10px"}},[t.score>=0?s("Sharing",{key:"beforeTest",attrs:{title:t.sharingTitle,img:"./assets/img/100.svg"}}):s("Sharing",{key:"afterTest",attrs:{title:t.sharingTitle,img:"./assets/img/100.svg"}})],1)],1):t._e(),s("div",{staticClass:"m-exam-op"},[s("Fav",{staticStyle:{"padding-top":"9px","padding-bottom":"9px"},attrs:{"post-type":"paper","post-id":t.id}}),t.isAuthor?s("el-button",{attrs:{type:"primary",plain:"",size:"small",icon:"el-icon-edit-outline"},on:{click:t.edit}},[t._v("编辑")]):t._e(),t.isAdmin?s("el-button",{attrs:{type:"danger",plain:"",size:"small",icon:"el-icon-delete"},on:{click:function(e){return t.check("delete")}}},[t._v("删除")]):t._e()],1)]),-1!==t.score?s("div",{staticClass:"c-exam-take-result"},[s("p",{staticClass:"result-score"},[t._v(t._s(t.score))]),s("p",{staticClass:"result-text"},[t._v("本次得分")])]):t._e(),t.questionList.length>0?t._l(t.questionList,(function(e,a){return s("div",{key:a,staticClass:"question-row"},[s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"card-header"},[s("div",{staticClass:"card-header-left"},[t._v(t._s(a+1))]),s("div",{staticClass:"card-header-right"},[s("span",{staticClass:"q-attr-value"},t._l(JSON.parse(e.tags),(function(e){return s("el-tag",{key:e,attrs:{size:"small"}},[t._v(t._s(e))])})),1)])]),s("div",{staticClass:"c-exam-take-content"},[s("h3",{staticClass:"q-text"},[s("span",{staticClass:"q-hint"},[t._v(" ["+t._s("checkbox"===e.type?"多选题":"单选题")+"] ")]),s("Article",{attrs:{content:e.title}})],1),"checkbox"===e.type?[s("el-checkbox-group",{model:{value:t.userAnswers[e.id],callback:function(s){t.$set(t.userAnswers,e.id,s)},expression:"userAnswers[question.id]"}},t._l(JSON.parse(e.options),(function(a,i){return s("el-checkbox",{key:i,class:{"is-correct-answer":t.isCorrectAnswerClass(e.id,i),"is-wrong-answer":t.isWrongAnswerClass(e.id,i)},attrs:{label:i,border:"",disabled:t.isSubmitted}},[t._v(" "+t._s(String.fromCharCode(65+i))+". "),s("Article",{attrs:{content:a}})],1)})),1)]:[s("el-radio-group",{model:{value:t.userAnswers[e.id],callback:function(s){t.$set(t.userAnswers,e.id,s)},expression:"userAnswers[question.id]"}},t._l(JSON.parse(e.options),(function(a,i){return s("el-radio",{key:i,class:{"is-correct-answer":t.isCorrectAnswerClass(e.id,i),"is-wrong-answer":t.isWrongAnswerClass(e.id,i)},attrs:{label:i,border:"",disabled:t.isSubmitted}},[t._v(" "+t._s(String.fromCharCode(65+i))+". "),s("Article",{attrs:{content:a}})],1)})),1)],s("div",{staticClass:"q-attr"},[s("p",{staticClass:"q-attr-content u-author"},[s("span",{staticClass:"q-attr-prop"},[t._v("出题人：")]),s("span",{staticClass:"q-attr-value"},[s("el-link",{attrs:{href:t.getQAuthorLink(e.createUserId),target:"_blank"}},[t._v(t._s(e.createUser))])],1)]),s("p",{staticClass:"q-attr-content u-hardstar"},[s("span",{staticClass:"q-attr-prop"},[t._v("难度：")]),s("span",{staticClass:"q-attr-value"},[s("el-rate",{attrs:{disabled:"","text-color":"#ff9900"},model:{value:e.hardStar,callback:function(s){t.$set(e,"hardStar",s)},expression:"question.hardStar"}})],1)])])],2)]),void 0!==t.eachCorrectiveness[e.id]?s("el-card",{staticClass:"box-card-result"},[null===t.userAnswers[e.id]?s("p",{staticClass:"card-result-status",staticStyle:{color:"#f12e2e"}},[t._v("未作答")]):t.eachCorrectiveness[e.id]?s("p",{staticClass:"card-result-status",staticStyle:{color:"#18ca4e"}},[t._v("回答正确")]):s("p",{staticClass:"card-result-status",staticStyle:{color:"#f12e2e"}},[t._v("回答错误")]),s("p",{staticClass:"card-result-options"},[t._v("你的答案："+t._s(t.userAnswerDisplayString(e.id)))]),s("p",{staticClass:"card-result-options"},[t._v(" 正确答案："+t._s(t.correctAnswers[e.id].map((function(t){return String.fromCharCode(65+t)})).join(""))+" ")]),s("el-divider"),s("p",{staticStyle:{color:"#2682ea","font-size":"20px","font-weight":"800"}},[t._v("解析：")]),s("Article",{attrs:{content:t.whyami[e.id]}})],1):t._e()],1)})):t._e(),s("div",{staticClass:"c-exam-take-btn"},[!t.isSubmitted&&!t.loading&&t.questionList.length>0?s("el-button",{attrs:{type:"success"},on:{click:t.preSubmitPaper}},[t._v("提交试卷")]):t._e()],1)],2),s("div",{staticClass:"m-exam-comment"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("讨论")]),s("Comment",{attrs:{id:t.id,category:"paper"}})],1)])},i=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",{staticClass:"c-exam-attr-content",staticStyle:{"margin-top":"-8px"}},[s("span",{staticClass:"c-exam-attr-prop"},[t._v("总共题数：")]),s("span",{staticClass:"c-exam-attr-value"},[t._v("共10题，每题10分，满分100分。")])])}],n=(s("b64b"),s("b0c0"),s("d3b7"),s("159b"),s("99af"),s("d81d"),s("25f0"),s("4e82"),s("caad"),s("2532"),s("a15b"),s("408b"),s("65c2"),s("ee8f"),s("c9d2")),r=s("85e4"),o=s("a974"),c=s("23d8"),u=s("6f05"),l=(s("2777"),s("41cb"));function d(t){return Object(l["d"])({proxy:!0}).get("api/question/user-exam-paper/"+t+"?details")}function p(t,e){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(l["d"])({proxy:!0}).post("api/question/user-exam-paper/".concat(t,"/i-finish-all").concat(s?"?force":""),e)}function f(t){return Object(l["d"])({proxy:!0}).post("api/question/user-exam-paper/".concat(t,"/i-need-answer"))}var h=s("9616"),m={name:"TakeExam",components:{Comment:c["a"],Article:o["a"]},data:function(){return{examid:-1,views:-1,loading:!0,examInfo:{title:"试卷"},marks:[{label:"官方试卷",value:"official"}],userAnswers:{},chosenOptions:null,questionCount:10,questionIdList:[],questionList:[],currentQuestionNumber:1,isSubmitted:!1,authorAvatarUrl:"",correctCount:-1,score:-1,correctAnswers:{},eachCorrectiveness:{},whyami:{},sharingTitle:"试卷",isAdmin:n["a"].isEditor(),author_id:""}},computed:{paperAuthorAvatar:function(){return Object(r["showAvatar"])(this.authorAvatarUrl,"s")},paperAuthorLink:function(){return Object(r["authorLink"])(this.examInfo.authorId)},id:function(){return this.$route.params.id},isAuthor:function(){return n["a"].isLogin()&&n["a"].getInfo().uid==this.author_id}},watch:{userAnswers:{handler:function(t,e){0!==Object.keys(this.generateFinalAnswer().finalAnswers).length&&"localhost"!=location.hostname&&this.checkLogin()},deep:!0}},mounted:function(){this.getExamInfo(),"exam-take"==this.$route.name&&Object(h["b"])("paper",this.$route.params.id)},methods:{checkLogin:function(){n["a"].isLogin()||(this.$message.error("请先登录"),n["a"].destroy(),setTimeout((function(){n["a"].toLogin()}),1e3))},getExamInfo:function(){var t=this;this.examid=this.id;var e=this.$route.params;e&&(this.examInfo=e.examInfo),this.loading=!0,d(this.examid).then((function(e){e=e.data,t.examid=e.id,t.author_id=e.createUserId;var s=null;t.marks.forEach((function(t){t.value===e.corner&&(s=t.label)})),t.examInfo={category:e.category,corner:s,desc:e.desc,medalAward:e.medalAward,title:e.title,tags:e.tags,author:e.createUser,authorId:e.createUserId},t.questionIdList=e.questionIdList;var a=e.questionDetailList,i={};a.forEach((function(t){"checkbox"===t.type?i[t.id]=[]:i[t.id]=null})),t.userAnswers=i,t.questionList=a,t.questionCount=t.questionIdList.length,t.sharingTitle=t.examInfo?t.examInfo.title:"试卷",t.getStats()})).catch((function(t){console.log(t)})).finally((function(){t.loading=!1}))},getStats:function(){var t=this;Object(h["a"])("paper",this.examid).then((function(e){"views"in e.data&&(t.views=e.data.views)})).catch((function(e){switch(e=e.response,e.status){case-1:t.$message.error(e.msg);break;case 9999:t.$message.error("登录失效, 请重新登录"),n["a"].destroy(),setTimeout((function(){n["a"].toLogin()}),1e3);break;default:t.$message.error("[".concat(e.code,"]").concat(e.msg))}}))},postStats:function(){var t=this;Object(h["b"])("paper",this.examid).then((function(t){})).catch((function(e){switch(e=e.response,e.status){case-1:t.$message.error(e.msg);break;case 9999:t.$message.error("登录失效, 请重新登录"),n["a"].destroy(),setTimeout((function(){n["a"].toLogin()}),1e3);break;default:t.$message.error("[".concat(e.code,"]").concat(e.msg))}}))},generateFinalAnswer:function(){var t=this,e={},s=!0,a=function(a){for(var i=t.userAnswers[a],n=[],r=0;r<t.questionList.length;++r)if(t.questionList[r].id==a){n=t.questionList[r].options;break}n=JSON.parse(n),null===i?s=!1:"number"!==typeof i?0===i.length?s=!1:e[a]=i.map((function(t){return n[t]})):e[a]=[n[i]]};for(var i in this.userAnswers)a(i);return{finalAnswers:e,isFinished:s}},preSubmitPaper:function(){var t=this,e=this.generateFinalAnswer(),s=e.finalAnswers,a=e.isFinished;a?this.submitPaper(s):this.$confirm("还没有完成所有题目的作答，是否继续答题？","提示",{cancelButtonText:"继续答题",confirmButtonText:"不管了，我要交卷",type:"warning"}).then((function(){0===Object.keys(s).length?t.$alert("不能交白卷哦~","提交失败",{type:"error"}):t.submitPaper(s,!0)})).catch((function(){return!1}))},submitPaper:function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.$confirm("提交试卷后将无法再修改作答，且每套试卷只能作答一次。是否确定提交？","提示",{cancelButtonText:"我再看看",confirmButtonText:"确定提交",type:"warning"}).then((function(){e.isSubmitted=!0,e.loading=!0,p(e.examid,t,s).then((function(t){t=t.data,t.score?(e.correctCount=t.score.questionRightCount,e.sharingTitle="我在".concat(e.examInfo.title,"中取得了").concat(t.score.score,"分的好成绩，你也快来试试吧！"),e.score=t.score.score,window.scrollTo(0,0),t.paper.questionDetailList[0].answerList?e.parseSolution(t.paper.questionDetailList):e.getSolution()):(e.isSubmitted=!1,t.msg&&e.$message.error("[".concat(t.code,"]").concat(t.msg)))})).catch((function(t){switch(e.isSubmitted=!1,t=t.response,t.status){case-1:e.$message.error(t.msg);break;case 401:e.$message.error("登录失效, 请重新登录"),n["a"].destroy(),setTimeout((function(){n["a"].toLogin()}),1e3);break;default:e.$message.error("[".concat(t.status,"]").concat(t.msg))}})).then((function(){e.loading=!1}))})).catch((function(){return!1}))},parseSolution:function(t){var e={},s={},a={};t.forEach((function(t){e[t.id]=t.answerList,s[t.id]=void 0!==t.myAnswer&&t.answerList.sort().toString()===t.myAnswer.sort().toString(),a[t.id]=t.whyami})),this.correctAnswers=e,this.eachCorrectiveness=s,this.whyami=a},getSolution:function(){var t=this;this.loading=!0,f().then((function(e){e=e.data,e.paper&&e.paper.questionDetailList&&t.parseSolution(e.paper.questionDetailList)})).catch((function(e){switch(e.code){case-1:t.$message.error(e.msg);break;case 9999:t.$message.error("登录失效, 请重新登录"),n["a"].destroy(),setTimeout((function(){n["a"].toLogin()}),1e3);break;default:t.$message.error("[".concat(e.code,"]").concat(e.msg))}})).then((function(){t.loading=!1}))},isCorrectAnswerClass:function(t,e){return Object.keys(this.correctAnswers).length>0&&this.correctAnswers[t].includes(e)},isWrongAnswerClass:function(t,e){if(Object.keys(this.correctAnswers).length>0&&!this.correctAnswers[t].includes(e)&&null!==this.userAnswers[t]){if(this.userAnswers[t]===e)return!0;if("number"!==typeof this.userAnswers[t])return this.userAnswers[t].includes(e)}return!1},userAnswerDisplayString:function(t){var e=this.userAnswers[t];return null===e?"未作答":"number"!==typeof e?e.map((function(t){return String.fromCharCode(65+t)})).join(""):String.fromCharCode(65+e)},getQAuthorLink:function(t){return Object(r["authorLink"])(t)},check:function(t){var e=this;"delete"==t?this.$alert("确定删除吗？","消息",{confirmButtonText:"确定",callback:function(s){"confirm"==s&&Object(u["a"])(e.id,t).then((function(t){e.$message({message:t.data.msg||"操作成功",type:"success"}),location.reload()}))}}):Object(u["a"])(this.id,t).then((function(t){e.$message({message:t.data.msg||"操作成功",type:"success"}),location.reload()}))},edit:function(){location.href=Object(r["publishLink"])("paper")+"/"+this.id}}},g=m,v=(s("8b33"),s("e5ab"),s("2877")),b=Object(v["a"])(g,a,i,!1,null,"c7dfc7bc",null);e["default"]=b.exports},"25f0":function(t,e,s){"use strict";var a=s("6eeb"),i=s("825a"),n=s("d039"),r=s("ad6d"),o="toString",c=RegExp.prototype,u=c[o],l=n((function(){return"/a/b"!=u.call({source:"a",flags:"b"})})),d=u.name!=o;(l||d)&&a(RegExp.prototype,o,(function(){var t=i(this),e=String(t.source),s=t.flags,a=String(void 0===s&&t instanceof RegExp&&!("flags"in c)?r.call(t):s);return"/"+e+"/"+a}),{unsafe:!0})},2777:function(t,e,s){"use strict";var a=s("bc3a"),i=s.n(a);s.d(e,"a",(function(){return i.a}));var n=s("65c2");i.a.create({baseURL:n["__server"],withCredentials:!0}),i.a.create({withCredentials:!0,baseURL:n["__next"]})},"6f05":function(t,e,s){"use strict";s.d(e,"b",(function(){return r})),s.d(e,"a",(function(){return o}));var a=s("2777"),i=s("65c2"),n=i["__next"]+"api/question/";function r(t,e){return a["a"].put(n+t+"/check","",{params:{action:e},withCredentials:!0})}function o(t,e){return a["a"].put(n+"exam-paper/"+t+"/opt","",{params:{action:e},withCredentials:!0})}},"8b33":function(t,e,s){"use strict";s("fa8e")},"96e2":function(t,e,s){},a15b:function(t,e,s){"use strict";var a=s("23e7"),i=s("44ad"),n=s("fc6a"),r=s("a640"),o=[].join,c=i!=Object,u=r("join",",");a({target:"Array",proto:!0,forced:c||!u},{join:function(t){return o.call(n(this),void 0===t?",":t)}})},e5ab:function(t,e,s){"use strict";s("96e2")},fa8e:function(t,e,s){}}]);
//# sourceMappingURL=chunk-0aef7700.76c4367c.js.map